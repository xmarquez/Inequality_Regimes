Inequality Regimes and Rawlsian Growth Rates: Some thoughts on the evolution of inequality 1960-2010, with special reference to Venezuela
========================================================

(Mostly an excuse to play with the [Standardized Worldwide Income Inequality Database](http://myweb.uiowa.edu/fsolt/swiid/swiid.html), compiled by [Frederick Solt](http://myweb.uiowa.edu/fsolt/), which I just discovered. This post also belongs, loosely speaking, to my [long-running series on the quantitative history of political regimes](http://abandonedfootnotes.blogspot.co.nz/search/label/history%20of%20political%20regimes). R code for everything in this blogpost available in this [Git repository](https://github.com/xmarquez/Inequality_Regimes); you would need to download the dataset separately)

Inequality is difficult to measure. Socially relevant inequalities are manifold, and measurable inequalities in money income are not always especially important. (In the formerly communist states of Eastern Europe income was very evenly distributed; yet this did not mean that there were no important social inequalities). Even inequality in money income is not easy to measure properly. Most existing data is not very comparable accross countries or years, and it is often not even clear to what income concept the sorts of inequality measures people typically use to make a point in political discourse refer to: does it refer to after-tax, after-transfer income or to "market" income? Does it refer to individual or household income? What sorts of things are counted as "income"? How do we account for access to high-quality public services? At best, measures of income inequality are uncertain estimates of an unknown distribution of potential living standards, more or less valid for societies where "money income" is a useful proxy for the ability of people to enjoy various important goods, and of little value outside the context of a conception of a "just distribution" of these capabilities. 

Despite the fact that estimates of what is essentially a statistical abstraction often play surprisingly big roles in current political debates (cf. the debate over [The Spirit Level](http://abandonedfootnotes.blogspot.co.nz/2010/11/equality-and-domination-footnote-on.html) some years ago, or recent [concern](http://www.nzherald.co.nz/nz/news/article.cfm?c_id=1&objectid=10828941) about a rise in New Zealand's gini index), I have recently become more skeptical about the importance of *measured* income inequality in politics: whatever importance the actual distribution of incomes has for political life in a society, it has to be mediated through complicated processes that refract local lived experience through the prism of context-dependent fairness norms that are [only vaguely related](http://dartthrowingchimp.wordpress.com/2013/02/03/enough-about-inequality-and-unrest-already/), if at all, to the numbers used to measure its skewness. 

Yet I'm curious: what sorts of income inequality have in fact increased, and where? How might these changes have mattered? Enter a new and shiny dataset: the [Standardized Worldwide Income Inequality Database](http://myweb.uiowa.edu/fsolt/swiid/swiid.html), which promises to ameliorate some of these measurement problems. The database uses the [Luxembourg Income Study](http://www.lisdatacenter.org/) - very high quality income inequality data - to calibrate the much larger but less comparable United Nations University [World Income Inequality Database](http://www.wider.unu.edu/research/Database/en_GB/database/). The result: lovely long time series estimates of both the market and the after tax, after transfer (net) [gini index of inequality](http://en.wikipedia.org/wiki/Gini_coefficient), including standard errors, for 153 countries. My first though on learning about this was: graphs! (Hopefully some non-obvious facts are also involved below).

```{r preparation, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE}
#Load required libraries`
library(plyr)
library(scales)
library(countrycode)
library(ggplot2)

# You may also need the Hmisc package for some of the graphs below.

# Load SWIID dataset, available via http://myweb.uiowa.edu/fsolt/swiid/swiid.html

swiid <- read.csv("../Data/SWIIDv3_1/SWIIDv3_1.csv") #Change directory to where you have downloaded the SWIID file

# This defines some convenient sets of countries to use below

LatinAmerica <- c("Argentina","Bolivia","Brazil","Chile","Colombia","Ecuador","Paraguay","Peru","Uruguay","Venezuela","Honduras","Mexico","Costa Rica","El Salvador","Nicaragua","Guatemala","Panama","Cuba","Dominican Republic","Puerto Rico")

ComparisonCases <- c("New Zealand","United States","Venezuela","Egypt","Turkey")

MENA <- c("Bahrain", "Egypt", "Iran", "Iraq", "Israel", "Jordan", "Kuwait", "Lebanon", "Yemen, Republic of", "United Arab Emirates", "Libya", "Morocco", "Oman", "Qatar", "Syria", "Saudi Arabia", "Tunisia")

# Here we calculate the change in net and market gini year on year, both absolute and in percentage terms, and add the geometric mean of such changes, per country

swiid <- ddply(swiid, .(country),transform, diff_net = c(NA,diff(gini_net)))

swiid <- ddply(swiid, .(country),transform, percent_diff_net = c(NA,diff(gini_net))/gini_net)

swiid <- ddply(swiid, .(country),transform, diff_market = c(NA,diff(gini_market)))

swiid <- ddply(swiid, .(country),transform, percent_diff_market = c(NA,diff(gini_market))/gini_market)

# This adds region information and country codes to the data using the countrycode package (some info is missing):

swiid$iso3c <- countrycode(mapvalues(swiid$country,from=c("Czechoslovakia", "Yugoslavia"), to=c("Czech Republic", "Serbia")), "country.name", "iso3c", warn=TRUE)
swiid$region <- countrycode(swiid$iso3c,"iso3c","region",warn=TRUE)
swiid$continent <- countrycode(swiid$iso3c,"iso3c","continent",warn=TRUE)

# The following is necessary if we want to merge the inequality data with the Unified Democracy Scores by Melton, Meserve, and Pemstein, available from http://www.unified-democracy-scores.org/ 
# Comment out if you do not wish to do this.

uds <- read.csv("../Data/uds_summary.csv") # Change directory if needed
uds$iso3c <- countrycode(mapvalues(uds$country,from=c("Czechoslovakia", "UAE", "Yugoslavia (Serbia)"),to=c("Czech Republic", "United Arab Emirates", "Serbia")), "country.name", "iso3c", warn=TRUE)
uds <- rename(uds, replace = c("country" = "country.pwt")) 
uds$dem <- cut(uds$mean,breaks=2,labels=c("Dictatorship","Democracy"))
uds$dem2 <- cut(uds$mean,breaks=3,labels=c("Dictatorship","Hybrid","Democracy"))
swiid_uds <- merge(swiid, uds, by=c("iso3c","year"))

# The following is necessary if we want to merge the inequality dataset with the Penn World Table of internationally comparable per capita GDP, available from http://www.rug.nl/research/ggdc/data/penn-world-table (I'm using version 8.0 here)

pwt <- read.csv("../Data/pwt80.csv") # Change directory if needed 
pwt <- rename(pwt, replace = c("countrycode" = "iso3c","country" = "country.pwt"))
swiid_pwt <- merge(swiid, pwt, by=c("iso3c","year"))

# Full data

full <- merge(swiid_pwt, uds, by=c("iso3c","year"))

# This function helps to calculate slopes for various trends

calculate_slopes <- function(data, splitvar = "country", depvar = "log(gini_net)", indvar = "year") {
  models <- dlply(data, .variables = splitvar, lm, formula=as.formula(paste(depvar, "~", indvar)))
  coefs <- ldply(models, coef)
  names(coefs)[length(splitvar) + 2] <- "slope"
  conf.intervals <-ldply(models, confint, parm = indvar)
  names(conf.intervals)[(length(splitvar) + 1):(length(var) + 2)] <- c("low", "high")
  parameter_estimates <- merge(coefs, conf.intervals)
  merge(data,parameter_estimates)
}

# For use with the Venezuela case, here's Michael Ross's oil and gas dataset, available here: http://dvn.iq.harvard.edu/dvn/dv/mlross/faces/study/StudyPage.xhtml?globalId=hdl:1902.1/20369&studyListingIndex=3_c2ec135da1205280fe9a006b68ba

Ross <- read.table("../Data/Ross Oil & Gas Data 1932-2011.tab", sep = "\t", header = TRUE)
Ross$cty_name <- mapvalues(Ross$cty_name, from = c("Venezuela, RB"), to = c("Venezuela"))

```

Let's start by looking at a country that has often [been cited as a great success in reducing inequality](http://en.wikipedia.org/wiki/Bolivarian_Missions): Venezuela during the Chavez years. (Also, I was there recently visiting family after a long absence, and I have a personal interest in understanding the changes that have occurred during that time). One question I've been curious about concerns the evolution of inequality in Venezuela relative to other Latin American countries, especially since the coming to power of Chavez in 1999. How do changes in inequality in Venezuela compare to changes elsewhere? 

In the following plot, we see changes in both the market ("equivalized (square root scale) household gross (pre-tax, pre-transfer) income", if you must know) and the net gini index of inequality (after tax, after transfer) in 19 Latin American countries from 1999 until 2010, ordered by the estimated rate of inequality reduction (countries that reduced inequality faster appear earlier; read the graph from right to left, top to bottom):

```{r LatinAmericanTrendsInequality, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}

ordered_trends_graph <- function(data) {

  data <- calculate_slopes(data)
  
  data$country2 <- reorder(data$country, data$slope)
  levels(data$country2) <- paste(seq_along(levels(data$country2)),". ",levels(data$country2))
  
  Gini.net.trends <- ggplot(data=data,aes(x = year, y = gini_net, ymax = gini_net + 1.96 * gini_net_se, ymin = gini_net - 1.96 * gini_net_se))
  
  Gini.net.trends <- Gini.net.trends + geom_pointrange() + facet_wrap(~ country2) + geom_smooth(method="lm")
  
  Gini.net.trends + geom_pointrange(data=data,aes(x = year, y = gini_market, ymax = gini_market + 1.96 * gini_market_se, ymin = gini_market - 1.96 * gini_market_se), color="red") + geom_smooth(data = data, aes(x = year, y = gini_market, ymax = gini_market + 1.96 * gini_market_se, ymin = gini_market - 1.96 * gini_market_se), method = "lm") + ylab("Gini index: red for market gini, black for net gini\nOrdered by slope of trend in net gini changes (faster decreases first)") + geom_hline(yintercept = min(data$gini_net), linetype="dotted")
  
}

data <- swiid[ swiid$country %in% LatinAmerica, ]
data <- data[ data$year > 1998, ]

fig1 <- ordered_trends_graph(data=data)

fig1


```

Inequality in Venezuela has indeed decreased relatively quickly since 1999 - the second fastest decrease after Ecuador, which has also had left-leaning governments (though a far more unstable political context, with five different presidents since 1998). Three things are worth noting about the context of these trends, however. 

First and most important is that this reduction in inequality is *not* driven by direct redistribution: there is barely any difference between the "market" gini index (our measure of inequality *before* taxes and transfers) and the "net" gini index (our measure of inequality *after* taxes and transfers). To the extent that the reduction in inequality is the result of government action rather than something else, it must have come about through measures like investment in human capital and labor market policies (see [Morgan and Kelly 2012](http://journals.cambridge.org/action/displayAbstract?fromPage=online&aid=8948630), ungated [here](http://web.utk.edu/~nkelly/papers/papers.html), for the proper peer-reviewed argument). This is true of all Latin American countries save for Puerto Rico (which is part of the USA in a sense) and (to a lesser extent) Brazil; indeed, redistribution in some countries (Peru) appears to have perversely *increased* inequality. 

Second, most Latin American countries have experienced reductions in inequality during this period, though most remain highly unequal. But Venezuela was *already* among the most equal countries in Latin America; in 1999, only Uruguay and Costa Rica had lower measured inequality (and the difference in net gini was within the margin of measurement error, so it should probably be disregarded). This surprised me; I had expected higher levels of inequality in Venezuela when compared to other countries, given the level of class conflict on display during the Chavez era. More surprisingly perhaps, if we take a broader look we discover that inequality in Venezuela appears to have been remarkably stable over the past fifty years, fluctuating around a flat trend:


```{r LongerRunVenezuelaInequality, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}

data <- swiid[ swiid$country %in% c("Venezuela"), ]
data <- subset(data, year > 1964) #eliminates one outlier at the beginning of the series that makes the graph look funny

fig2 <- ggplot(data=data,aes(x = year, y = gini_net, ymax = gini_net + 1.96 * gini_net_se, ymin = gini_net - 1.96 * gini_net_se))
  
fig2 <- fig2 + geom_pointrange() + geom_smooth(method="lm")
  
fig2 <- fig2 + geom_pointrange(data=data,aes(x = year, y = gini_market, ymax = gini_market + 1.96 * gini_market_se, ymin = gini_market - 1.96 * gini_market_se), color="red") + geom_smooth(data = data, aes(x = year, y = gini_market, ymax = gini_market + 1.96 * gini_market_se, ymin = gini_market - 1.96 * gini_market_se), method = "lm") + ylab("Gini index: red for market gini, black for net gini\nOrdered by slope of trend in net gini changes (faster decreases first)") + geom_hline(yintercept = min(data$gini_net), linetype="dotted")

fig2 <- fig2 + geom_vline(xintercept= c(1979, 1989, 1992, 1999), linetype="dashed") + annotate("text", x=c(1979, 1989, 1992, 1999),y= c(52, 52, 50, 52), label = c("Height of first oil boom","Caracazo","1992 coups","Chavez election"))

fig2 + ggtitle("Inequality trends in Venezuela, 1964-2010")

```
(Lines around dots represent 95% confidence intervals).

In fact, the low level of inequality in Venezuela as of 2010 only returned the country to the level of inequality it last experienced around ... 1992, the year of the [February coup](http://en.wikipedia.org/wiki/Venezuelan_coup_attempt_of_1992) which made Chavez famous, and **three years** after the "neoliberal" *paquete* of 1989 (which was supposed to have triggered the [Caracazo](http://en.wikipedia.org/wiki/Caracazo)). Inequality did increase after 1992, and poverty had increased before then - the Venezuelan economy had been in decline for a while, as we can see below. Which all goes to show, I suppose, that political unrest and lived experiences of injustice are only very loosely connected, if at all, with measures of income inequality; whereas austerity and large income losses appear more immediately important to political outcomes (as Jay Ulfelder argues [here](http://dartthrowingchimp.wordpress.com/2013/07/05/some-thoughts-on-the-causes-of-mass-protest/)):

```{r LongerRunGDPPerCapitaVenezuela, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}

data <- pwt[ pwt$country %in% c("Venezuela"), ]
data <- subset(data, year > 1964) 

fig3 <- ggplot(data=data,aes(x = year, y = rgdpe/pop))
  
fig3 <- fig3 + geom_point() + geom_smooth()
  
fig3 <- fig3 + ylab("Per capita GDP") + scale_y_continuous(labels=dollar)

fig3 <- fig3 + geom_vline(xintercept= c(1979, 1989, 1992, 1999), linetype="dashed") + annotate("text", x=c(1979, 1989, 1992, 1999),y= c(11000, 11000, 10000, 11000), label = c("Height of first oil boom","Caracazo","1992 coups","Chavez election"))

fig3 + ggtitle("GDP trends in Venezuela, 1964-2010")
```
(GDP per capita data from the [Penn World Table v. 8.0](http://www.rug.nl/research/ggdc/data/penn-world-table)).

Finally, it's probably worth noting that Venezuela's economic fortunes are deeply tied to oil prices, and that the rapid reduction in inequality in the last decade or so should also be placed in the context of the very large rise in the value of oil and gas during this period. Here is an estimate of the per capita value of oil and gas exports for Latin American countries, from [Michael Ross' oil and gas dataset](http://dvn.iq.harvard.edu/dvn/dv/mlross/faces/study/StudyPage.xhtml?globalId=hdl:1902.1/20369&studyListingIndex=3_c2ec135da1205280fe9a006b68ba), ordered by the average value of such exports:

```{r OilAndGasData, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}

data <- Ross[ Ross$cty_name %in% LatinAmerica, ]
data <- data[ data$year > 1998, ]
data$cty_name <- reorder(data$cty_name, -data$oil_gas_valuePOP_2009)

fig4 <- qplot(data = data, x = year, y = oil_gas_valuePOP_2009) + facet_wrap( ~ cty_name) + geom_smooth() + scale_y_continuous(labels=dollar) + ylab("Per capita value of oil and gas exports, 2009 dollars")

data <- Ross[ Ross$cty_name %in% c("Venezuela"), ]
data <- subset(data, year > 1964) 

fig5 <- ggplot(data=data,aes(x = year, y = oil_gas_valuePOP_2009))
  
fig5 <- fig5 + geom_point() + geom_smooth()
  
fig5 <- fig5 + ylab("Estimated per capita value of oil and gas exports") + scale_y_continuous(labels=dollar)

fig5 <- fig5 + geom_vline(xintercept= c(1979, 1989, 1992, 1999), linetype="dashed") + annotate("text", x=c(1979, 1989, 1992, 1999),y= c(7000, 7000, 6000, 7000), label = c("Height of first oil boom","Caracazo","1992 coups","Chavez election"))

fig5 + ggtitle("Value of oil and gas expoerts per capita in Venezuela, 1964-2010")


``` 
As we can see, Venezuela and Ecuador, the countries that have experienced the fastest inequality decreases, have been precisely the two countries that have benefitted the *most* from oil and gas price increases - money that flows directly to the state (especially since the Chavez government systematically asserted control over the state oil company) and can be used to provide employment and subsidize education, healthcare, housing, staples, and other goods, however inefficiently (e.g., the varios "[Misiones](http://en.wikipedia.org/wiki/Bolivarian_Missions)" and other social programs created by the Chavez government). At least some of these programs must have played some role in the reduction of inequality, but given the amount of oil and gas money flowing directly to the Venezuelan state (representing most Venezuela's exports, which [have become substantially less diversified over the last 15 years](http://www.atlas.cid.harvard.edu/explore/tree_map/export/ven/all/show/2010/)) and the typical patterns of clientelism and electoral politics in Venezuela it would have taken a bloody-minded kleptocrat **not** to reduce inequality by some amount. At any rate, inequality and poverty also diminished quite a bit during the 1970s oil boom, likely through similar channels - massive amounts of money flowing through the state, which increased its ability to employ people and subsidize public services. (I don't mean to sound grudging; though I have [doubts](https://www.google.co.nz/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&ved=0CC0QFjAA&url=http%3A%2F%2Ffrrodriguez.web.wesleyan.edu%2Fdocs%2Fworking_papers%2FFreed_from_Illiteracy.pdf&ei=DZzeUY_nBqGIiQf654GgDg&usg=AFQjCNF7QiMu6qGGfmQOE7GSyXdbLKdDMA&sig2=nKErxYAyu6dXwqsRJ_B15A&bvm=bv.48705608,d.aGc) about the effectivenes of some of these programs, some of the new housing built during the Chavez years looks decent, for example).

Let's take a broader look, however. How does the Venezuelan experience of inequality reduction compare to some countries outside of Latin America? Just because they've been in the news, let's look at the Venezuelan experience in coparison to Turkey and Egypt; and add the USA and New Zealand to see how two "developed" countries look as well. 

```{r ComparisonOutsideLatam1, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}

data <- swiid[ swiid$country %in% ComparisonCases, ] 
data <- data[ data$year > 1998, ]
fig6 <- ordered_trends_graph(data=data)
fig6


``` 
That's right: Egypt and Turkey apparently reduced inequality faster than Venezuela in this period (though the error estimates of the gini index for both are also larger), and were less unequal than Venezuela by the end of the period! Also, despite the fact that the degree of "market" inequality was higher in the USA and NZ than in Venezuela, and did not decrease or even increased a little during this period (as measured by the net gini index), both countries remain less unequal than Venezuela (as measured by the net gini index), due to the effectiveness of their redistributive measures. 

Now, this is perhaps surprising, but a bit of an aberration, and really, we are dealing with imperfectly estimated quantities (rates of decline) based on measurements with error. So there's really no point in arguing about whether inequality in Venezuela has in fact decreased faster than in Egypt or not; our methods of measuring inequality don't allow us to give a very precise answer to this question (error bars are large, etc.). In any case, it is clear that income inequality has declined pretty fast in Venezuela over the last 15 years, even allowing for some meaurement and estimation error, as we can see by calculating the trend rate of change in the net gini coefficient (the slope of a regression of log(gini_net) on year, to be technical, which yields the estimated trend annual percent rate change in the gini index) for all countries in the dataset:

```{r ComparisonOutsideLatam2, echo=FALSE, cache=TRUE, message=FALSE, fig.height=20, warning=FALSE, fig.width=11}

data <- calculate_slopes(swiid[ swiid$year > 1998, ])
data <- subset(data, !is.na(slope))
data <- ddply(data, .(country), transform, N = length(year))
data <- subset(data, N > 6) # eliminate cases where the slope was calculated with less than 7 observations
data <- unique(data[ , c("country","slope","high","low","N")])
data <- data[ order(data$slope,decreasing=TRUE), ]

fig7 <- qplot(data=data,x=reorder(paste(seq(from=length(data$country),to=1), country, sep=". "),-slope), y = slope, alpha=N, ymax=high, ymin=low, geom="pointrange") + coord_flip()+ geom_hline(yintercept=0,color="red")

fig7 <- fig7 + geom_vline(xintercept= match(ComparisonCases,data$country),linetype="dashed",color="red") + ggtitle("Estimated average yearly change in net gini, since 1998")+scale_y_continuous(labels=percent) + xlab("Country") + labs(alpha="N of obs.", y = "Estimated average yearly change in net gini \n(negative numbers = reduction, positive = increase)")

fig7

``` 
(I took out countries that had too few datapoints, since the trends didn't look to me like they could be informative. The error estimates in the graph are nevertheless probably too small, since one would need to use the proper rules for [error propagation](http://en.wikipedia.org/wiki/Propagation_of_uncertainty) to calculate them, which I have not done. Interestingly, the estimate of the rate of change in the net gini index for New Zealand and the USA since 1998 suggests basically that they have experienced no significant change in measured inequality from 1999 until 2010, contrary to popular belief; their important increases in inequality occurred earlier. More on this in a minute). 

What strikes me about this graph is that countries that have achieved very fast reductions in inequality over this period appear to be quite disparate; though left governments are in evidence among these, many countries apparently achieved fast reductions in inequality with supposedly "neoliberal" policies (e.g., Egypt and Turkey) that are now in turmoil. Maybe this is evidence that the gini index does not capture socially relevant changes in inequality; but then it would also fail to capture changes in inequality in non-neoliberal Venezuela and Ecuador. (Of course, other confounding factors may be at work too).

It is also curious that many of the fastest reductions in inequality have occurred in states that do not engage in a lot of explicit redistribution. In fact, a simple correlation between the average redistributive capacity of a state (measured by the percentage difference between the "market" gini and the net gini coefficient) and the rate of decrease in measured "final" inequality over the period is slightly *negative* (so fastest reductions in inequality have occurred in states that are unable to affect market gini very much at all, or that even increase it through perverse redistribution):

```{r RedistributionReductionRateCorrelation, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}

data <- calculate_slopes(swiid[ swiid$year > 1998, ])
data <- subset(data, !is.na(slope))
data <- ddply(data, .(country), transform, N = length(year))
data <- ddply(data, .(country), transform, mean_redist = mean((gini_market - gini_net)/gini_market, na.rm=TRUE))
data <- unique(data[ , c("country","slope","high","iso3c","low","N","mean_redist")])

fig8 <- qplot(data=data,x = mean_redist, y = slope, alpha = N, geom="text", label = country) +geom_smooth(method="lm")+ geom_hline(yintercept=0,color="red") + geom_vline(xintercept= 0, color = "red") + scale_y_continuous(labels=percent) + scale_x_continuous(labels=percent) + xlab("Average percentage change in market gini after redistribution \n(positive numbers = more reduction in market gini)") + labs(alpha="Number of observations", y = "Estimated average yearly change in net gini since 1998\n(negative numbers = reduction, positive = increase)") + scale_alpha(range=c(0.2,1))+theme(legend.position="bottom")

fig8


``` 

It's probably not worth making too much of this correlation (measurement errors, the relatively short time period under consideration, and confounding factors are not taken into consideration), though it does suggest that many changes in inequality seem beyond the control of most governments. But even when we expand the period of observation all the way to 1960, the correlation does not entirely disappear, though it weakens greatly:

```{r RedistributionReductionRateCorrelation2, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}

data <- calculate_slopes(swiid)
data <- subset(data, !is.na(slope))
data <- ddply(data, .(country), transform, N = length(year))
data <- ddply(data, .(country), transform, mean_redist = mean((gini_market - gini_net)/gini_market, na.rm=TRUE))
data <- unique(data[ , c("country","slope","high","iso3c","low","N","mean_redist")])
fig9 <- qplot(data=data,x = mean_redist, y = slope, alpha = N, geom="text", label = country) +geom_smooth(method="lm")+ geom_hline(yintercept=0,color="red") + geom_vline(xintercept= 0, color = "red") + scale_y_continuous(labels=percent) + scale_x_continuous(labels=percent) + xlab("Average percentage change in market gini after redistribution \n(positive numbers = more reduction in market gini)") + labs(alpha="Number of observations", y = "Estimated average yearly change in net gini since 1960\n(negative numbers = reduction, positive = increase)") + scale_alpha(range=c(0.2,1))+theme(legend.position="bottom")

fig9


``` 

Ultimately, however, the more **directly** and **explicitly** redistributive the state has been, the more equal it also appears to be over the long run:

```{r RedistributionInequalityCorrelation, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}

data <- swiid
data <- ddply(data, .(country), transform, N = length(year))
data <- ddply(data, .(country), transform, redist = (gini_market - gini_net)/gini_market)
data <- ddply(data, .(country), transform, mean_redist = mean(redist, na.rm=TRUE))
data <- ddply(data, .(country), transform, mean_gini_net = mean(gini_net,na.rm=TRUE))
data <- ddply(data, .(country), transform, mean_gini_market = mean(gini_market,na.rm=TRUE))

fig10 <- ggplot(data = data, aes(x = redist, y = gini_net)) + geom_point(alpha=0.1,color=data$country) + geom_smooth(method="lm") +geom_text(data = unique(data[ ,c("country","mean_redist","mean_gini_net")]), aes(x = mean_redist, y = mean_gini_net, label = country))+ geom_vline(xintercept=0,color="red") + scale_x_continuous(labels=percent) + xlab("Percentage change in market gini after redistribution \n(positive numbers = more reduction in market gini)") + labs(y = "Average net gini since 1960\n(Dashed red line = approximate fit of avg market gini\n Blue line = Approximate fit of avg net gini)")+geom_smooth(data = data, aes(x = mean_redist, y = mean_gini_market), color="red", method = "lm", linetype="dashed")

fig10

```  

Or, to put it crudely, since 1960 at least market inequality has only been reliably reduced in states that **take from the rich and give to the poor**. And yet actually taking from the rich and giving to the poor seems to put nontrivial demands on state capacity and political life (witness the existence of robber states that take from the poor and give to the rich). The degree of change in the market distribution of income even appears to be a fair measure of that capacity; from the graph above, it's likely that a state that can consistently reduce gini index of market inequality by at least 30% is a pretty "strong" state (in the "[infrastructural](http://www.sscnet.ucla.edu/soc/faculty/mann/Doc1.pdf)" sense of strong), whereas a state that cannot make a dent on the market distribution of income is more likely to be "weak" (with some communist exceptions like the USSR that did not engage in a great deal of explicit redistribution, since, to put it crudely the state owned everything and everyone more or less got paid the same).

And abilities to redistribute income appear to be remarkably "sticky." Few countries appear to become **more** able to affect the gini distribution over time:

```{r StickinessOfRedistributiveCapacity, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11, fig.height=18}

data <- swiid
data <- transform(data, redist = (gini_market - gini_net)/gini_market)
data <- calculate_slopes(data, depvar="redist")
data <- subset(data, !is.na(slope))
data <- ddply(data, .(country), transform, N = length(year))
data <- subset(data, N > 10)
data <- data[ order(data$slope), ]
data$country <- factor(as.character(data$country), ordered=TRUE)
data$country <- reorder(data$country, -data$slope)


levels(data$country) <- paste(seq_along(levels(data$country)), levels(data$country))

fig11 <- qplot(data=data, x=year, y=redist,alpha=N)+ geom_smooth(method="lm")+facet_wrap(~country, ncol=7)+ geom_hline(yintercept=0,color="red")+scale_y_continuous(labels=percent)

fig11 <- fig11 + labs(y = "Redistributive capacity \n(Percent change in market gini after taxes and transfers)\n(ordered by steepness of trend)") + scale_alpha(range=c(0.1,1))

fig11


```
(I've deleted cases with very few data points to make the graph look prettier. See the [code](https://github.com/xmarquez/Inequality_Regimes) for the details). What is striking about this graph is how stable the redistributive capacity of most states has remained over a period of more than six decades: many countries show basically zero change in their ability to change the income distribution. To be sure, some countries have increased their redistributive capacity -- France is a good example -- and others experience wild swings in redistributive capacity, probably related to big political conflicts -- note Bangladesh and Chile, the latter with a big bump around the time of Allende. But at best we can detect a long-term decline in redistributive capacity for the majority of cases (even if the decline is often slight); and often, after a decline, we see long periods of stability rather than change: countries settle into an "inequality regime," with some occasional big bumps which indicate new equilibria. 

Note that in many cases the redistributive capacity of the state does not change even while inequality increases: thus, for example, while the net gini has increased over the past six decades in the USA and New Zealand, their capacity to *affect* the gini coefficient has remained approximately the same (New Zealand has been able to reduce the market gini by about 27%, though there's a slight downwards trend in this number; the USA by about 22%). The structure of their economies changed (by political action, in part), producing more inequality, but their redistributive capacity *as states* remained basically the same. To decrease inequality by redistribution in cases where the market gini increases substantially seems to require either a big political shock, or a long-run increase in state capacity. 

There is another historical pattern that struck me as interesting: both levels of inequality and redistributive capacities seem to be highly correlated accross regions. Neighboring countries appear to have both similar levels of inequality and similar redistributive capacities. Linked economic and political histories seem to produce both the equilibrium level of inequality and the long-run redistributive capcity of the state. 

Here, for example, we see the average redistributive capacity of states per region:

```{r RedistCapacityPerRegion, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE}

data <- swiid
data <- transform(data, redist = (gini_market - gini_net)/gini_market)

data$region <- as.character(data$region)
data$region <- ifelse(data$country == "Taiwan", "Eastern Asia", data$region)
data$region <- as.factor(data$region)

fig12 <- qplot(data=data, x=reorder(region,redist, FUN=median, na.rm=TRUE), y=redist, geom="boxplot")+coord_flip()+xlab("Region") + ylab("Redistributive capacity \n(percent reduction in market gini after taxes and transfers, \nall obs. since 1960)")+ geom_hline(yintercept=c(0,median(data$redist,na.rm=TRUE)),color="red",linetype=c("solid","dashed"))+scale_y_continuous(labels=percent)

fig12

```

(Cases to the right of the solid line are states that on average made their income distribution more equal; the dashed line indicates the median redistributive capacity). 

And here is a graph of net gini per region (all observations since 1960): 

```{r GiniRegion, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE}

data <- swiid

data$region <- as.character(data$region)
data$region <- ifelse(data$country == "Taiwan", "Eastern Asia", data$region)
data$region <- as.factor(data$region)

fig13 <- qplot(data=data, x=reorder(region,gini_net, FUN=median), y=gini_net,geom="boxplot")+coord_flip()+xlab("Region") + ylab("Gini index, after taxes and transfers")+ geom_hline(yintercept=median(data$gini_net),color="red")

fig13

```

No great surprises here, perhaps: Sub-Saharan Africa and Latin America have been the world's most income-unequal regions over the last six decades, whereas Europe has been consistently equal - the home of both Northern social democracy and Eastern European communism, both of which have been able to keep the distribution of incomes relatively equal through explicit redistribution, though in somewhat different ways.  

But perhaps this is of little importance. On one (vaguely [Rawlsian](http://en.wikipedia.org/wiki/A_Theory_of_Justice)) view, what matters is not the income distribution per se, but the ways in which it affects the prospects of the worst off in society. How much does it matter whether or not inequality declines in any given society, especially for the poorest? This will depend on the growth rate of the economy; high growth with declining inequality will be better for the poor than low growth with increasing inequality, though the outcome of the comparison is ambiguous for high growth with increasing inequality or low growth with decreasing inequality. 

Now, it occurs to me that with the average income for these countries as well as their level of inequality, we can make an informed guess (technically, a **wild** guess) about the average income of various deciles for the years in which data is available. To do this properly would be too painful for a blog post, but I assume that empirical income distributions more or less fit a lognormal distribution (even though they [fit more exotic distributions better](http://www.jstor.org/stable/1913469), like the [Singh-Maddala](http://en.wikipedia.org/wiki/Burr_distribution) distribution or the [generalized Beta distribution](http://en.wikipedia.org/wiki/Generalized_beta_distribution)). With a little help from R, I can then simulate the average income of each decile of every country in the SWIID dataset. (Take a look at the [code](https://github.com/xmarquez/Inequality_Regimes) for the gory details. Also: this is a **VERY** rough and ready simulation, extremely inefficient to run and cooked up in a day. Do not take these numbers too seriously). We can then provide some vaguely informed answers to a Rawlsian question: which countries have most increased the prospects of the poorest over the last six decades? 

```{r RawlsianCountriesSimulation, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE}
library(ineq)
library(reshape2)

# Here I empirically derive the relationship between the sdlog parameter of the lognormal distribution and the gini coefficient so I can simulate a lognormal distribution of income with any desired inequality coefficient

test_lognorm <- function(meanlog, sdlog) {
  y <- rlnorm(10000, meanlog=meanlog, sdlog=sdlog)
  cbind("meanlnorm" = mean(y), "gini" = ineq(y))
}

n.sims <- 1000
meanlog <- runif(n = n.sims, max = log(10000))
sdlog <- runif(n = n.sims, max = exp(1))

results <- mapply(test_lognorm, meanlog=meanlog, sdlog=sdlog)

results <- as.data.frame(t(results))

names(results) <- c("mean","gini")

results <- cbind(meanlog, sdlog, results)

model_gini <- loess(data = results, sdlog ~ gini)

rm(results, n.sims, meanlog, sdlog, test_lognorm)

# Basically, good enough for government work: the gini is about e times sdlog 

# This function generates a simulated income distribution with a given average income (rgdpe/pop) and a given gini coefficient (gini_net)

generate_simulated_deciles <- function(n = 10000, predicted_sdlog_data) {
  distributions <- as.data.frame((mapply(rlnorm, n = n, meanlog = log(data$rgdpe/data$pop), sdlog = predicted_sdlog_data)))
  ginis <- as.data.frame(t(sapply(distributions, ineq)))
  cuts <- seq(0,1,0.1)
  deciles <- as.data.frame(t(sapply(distributions, quantile, probs=cuts)))
  names(deciles) <- paste("d",cuts*100,sep="")
  cbind(country= data$country, year = data$year, deciles, simulated_ginis = t(ginis)*100)
}

# This function calculates the mean of many simulated deciles, and adds some useful quantities, like the 90/10 ratio

calculate_decile_mean <- function(n = 10, predicted_sdlog_data) {
  deciles <- generate_simulated_deciles(predicted_sdlog_data = predicted_sdlog_data)
  for(i in 1:(n-1)) {
    deciles <- rbind(deciles, generate_simulated_deciles(n = 10000, predicted_sdlog_data = predicted_sdlog_data))
  }
  
  deciles$d90d10ratio <- deciles$d90/deciles$d10
  deciles$rgdpepop <- data$rgdpe/data$pop
  deciles$gini_net <- data$gini_net
  
  deciles <- melt(deciles,id=c("country","year"))
  deciles <- ddply(deciles, .(country,year,variable), numcolwise(mean,na.rm=TRUE))
  deciles
}


data <- swiid_pwt[ !is.na(swiid_pwt$rgdpe), ] # uses the Penn World Table dataset, merged above with the SWIID dataset

data <- ddply(data, .(country), transform, N=length(country))

# Here we eliminate countries with fewer than 7 observations

data <- subset(data, N > 6)

# Drop unneeded vars

data <- subset(data, select=c("country","year","rgdpe","gini_net","pop"))

predicted_sdlog_data <- predict(model_gini,data.frame(gini = data$gini_net/100))

# Here we calculate deciles based on 100 iterations; depending on your system, this might take a while, since I'm not a particularly efficient coder.

simulated_deciles <- calculate_decile_mean(100, predicted_sdlog_data = predicted_sdlog_data)
```
The question admits of two more precise formulations, which we'll take on in turn: what countries have had the highest growth rate of income for the lowest deciles of the population? And second, in which countries do the poor have the highest incomes? (The first corresponds to a sort of *dynamic* version of the [difference principle](http://plato.stanford.edu/entries/justice-distributive/), which I find more interesting). Let's start with looking at the Rawlsian growth rate (the rate of income growth for the lowest decile, which we'll assume represents the group whose position must be maximized in Rawls' theory); the higher the long-run Rawlsian growth rate, the more the country fulfills the dynamic version of the difference principle. Though in theory the long-run growth rate of the economy as a whole and the long-run growth rate of the income of the lowest decile should perhaps converge, in practice they diverge, even over long time periods - some groups do well over some time frame, others do badly. Now, what we would actually want to know from a strict Rawlsian perspecive is the highest long-run growth rate of income for a representative person in the lowest decile of a given country relative to the potential growth rate of the whole economy (in other words, what degree of inequality *would* produce the highest income growth for that representative person, given the particular structure of that economy), but this is a counterfactual quantity we cannot estimate, so we'll make do with simulating the incomes of the lowest decile for the actual combinations of growth and inequality in existing economies. (I repeat my warning: this is only a simulation!)

First, we estimate the long-run Rawlsian growth rate (for countries with data going back far enough - so we drop countries that don't have long enough time trends, say at least 30 years):

```{r RawlsianLongRunRates, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.height = 18, fig.width=11}

data <- subset(simulated_deciles, variable %in% c("d10","rgdpepop","gini_net","simulated_ginis"))

data <- dcast(data, country + year ~ variable)

data <- calculate_slopes(data, depvar="log(d10)")

data <- rename(data, c("(Intercept)" = "Interceptd10","slope" = "RawlsGrowth","low"="RawlsLow","high"="RawlsHigh"))

data <- calculate_slopes(data, depvar="log(rgdpepop)")

data <- rename(data, c("(Intercept)" = "InterceptGrowth","slope" = "Growth","low"="GrowthLow","high"="GrowthHigh"))

data <- ddply(data, .(country), transform, minYear = min(year), maxYear = max(year), N=length(country), gini_net = mean(gini_net))

# This is where we drop countries without long enough time trends
# Change this number to see how the graph looks with other countries included
data <- subset(data, N > 30) 

data <- unique(data[ , c("country","RawlsGrowth","RawlsLow","RawlsHigh","Growth","GrowthLow","GrowthHigh", "minYear","maxYear","gini_net","N")])

data <- data[ order(data$RawlsGrowth, decreasing= TRUE), ]

data$country <- paste(seq_along(data$country),data$country,data$minYear,data$maxYear)

data <- data[ order(data$RawlsGrowth), ]

fig14 <- ggplot(data=data, aes(x=reorder(country,RawlsGrowth)))+ geom_pointrange(aes(y=RawlsGrowth,ymax=RawlsHigh,ymin=RawlsLow, color=gini_net)) + coord_flip() + geom_hline(yintercept=0,color="red") + scale_color_gradient2(midpoint=median(data$gini_net),low="blue",high="red") + scale_y_continuous(labels=percent)+labs(color="Avg. net gini",x="Country", y="Simulated avg. income growth rate for lowest decile (Rawlsian growth rate)")+ geom_vline(xintercept= grep("Venezuela|United States|China|New Zealand|Sweden|Egypt",data$country),linetype="dashed",color="red")+theme(legend.position="bottom")

fig14

```
The "Asian Tigers" unsurprisingly top the list: over the last six decades, Taiwan, Singapore, and South Korea had the highest (simulated) Rawlsian growth rate (in countries with at least 30 years of both GDP and gini data). South Korea and Taiwan are below average in inequality, which makes sense, but Singapore is not. Over the long run, in other words, a high enough growth rate of income seems to compensate for higher than average inequality. But one surprise among the top countries is Egypt - where the poorest decile, if we believe this simulation (and you shouldn't), had a pretty good run over many decades, despite Egypt not being considered a big performer in terms of its average per capita growth. At the bottom, by contrast, we find that Venezuela has essentially experienced zero Rawlsian growth over six decades (in fact, its long-run trend in regular per-capita annual growth is also zero). Though below average in inequality, its income has suffered so many ups and downs (mostly following oil price changes) that the trend is flat; no wonder Venezuelans eventually got tired of all their politicians before Chavez. 

Now, there obviously is a correlation between Rawlsian growth and regular growth, as well as between Rawlsian growth and average inequality, but it is not perfect, simply because the Rawlsian growth rate is a function of **both** the average growth rate **and** the gini index *by construction*, and these two things are not perfectly correlated; a high enough growth rate in the whole economy can overcome a large gini coefficient to produce high Rawlsian growth rates and vice-versa. But it's worth noting that extremely high levels of inequality do appear to be associated with plain low growth over the long run, bad for both the poor and everyone else except perhaps tiny kleptocratic elites: 

```{r RawlsiantoAverage, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}

data <- subset(simulated_deciles, variable %in% c("rgdpepop","gini_net"))

data <- dcast(data, country + year ~ variable)

data <- calculate_slopes(data, depvar="log(rgdpepop)")

data <- rename(data, c("(Intercept)" = "InterceptGrowth","slope" = "Growth","low"="GrowthLow","high"="GrowthHigh"))

data <- ddply(data, .(country), transform, N=length(country), gini_net = mean(gini_net))

data <- unique(data[ , c("country","Growth","gini_net","N")])

data <- melt(data, id.vars=c("country","gini_net","N"))

fig15 <- qplot(data=data, x=gini_net, y=value, alpha=N) + geom_smooth() + geom_text(aes(label=country))+xlab("Net gini")+ylab("Growth rate")+scale_y_continuous(labels=percent)

fig15


```
We can now repeat the exercise for the last 15 years and see how Venezuela stacks up since then:

```{r RawlsianLongRunRatesSince1999, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11, fig.height = 18}

data <- subset(simulated_deciles, variable %in% c("d10","rgdpepop","gini_net","simulated_ginis"))

data <- dcast(data, country + year ~ variable)

data <- subset(data, year > 1998)

data <- calculate_slopes(data, depvar="log(d10)")

data <- rename(data, c("(Intercept)" = "Interceptd10","slope" = "RawlsGrowth","low"="RawlsLow","high"="RawlsHigh"))

data <- calculate_slopes(data, depvar="log(rgdpepop)")

data <- rename(data, c("(Intercept)" = "InterceptGrowth","slope" = "Growth","low"="GrowthLow","high"="GrowthHigh"))

data <- ddply(data, .(country), transform, minYear = min(year), maxYear = max(year), N=length(country), gini_net = mean(gini_net))

# This bit is where we drop countries with too few observations for this period

data <- subset(data, N > 6)

data <- unique(data[ , c("country","RawlsGrowth","RawlsLow","RawlsHigh","Growth","GrowthLow","GrowthHigh", "minYear","maxYear","gini_net","N")])

data <- data[ order(data$RawlsGrowth, decreasing= TRUE), ]

data$country <- paste(seq_along(data$country),data$country,data$minYear,data$maxYear)

data <- data[ order(data$RawlsGrowth), ]

fig16 <- ggplot(data=data, aes(x=reorder(country,RawlsGrowth)))+ geom_pointrange(aes(y=RawlsGrowth,ymax=RawlsHigh,ymin=RawlsLow, color=gini_net)) + coord_flip() + geom_hline(yintercept=0,color="red") + scale_color_gradient2(midpoint=median(data$gini_net),low="blue",high="red") + scale_y_continuous(labels=percent)+labs(color="Avg. net gini",x="Country", y="Simulated avg. income growth rate for lowest decile \n(Rawlsian growth rate, since 1999)")+ geom_vline(xintercept= grep("Venezuela|United States|China|New Zealand|Sweden|Egypt",data$country),linetype="dashed",color="red")+theme(legend.position="bottom")

fig16

```
As we can see, the Chavez years (up to 2010; the data does not tell us what happened for the last three years) were quite good for the poor, according to this simulation: the combination of declining inequality and relatively high growth rates (due in great part to rising oil prices) made Venezuela a top ten Rawlsian performer - better even than China, which also had torrid growth rates but increasing inequality during this period. To be sure, this good "Rawlsian" growth rate is only relevant from a strict Rawlsian perspective if we ignore the equal liberties principle, which is meant to have priority; and [increasing disregard of classic liberal rights](http://muse.jhu.edu/login?auth=0&type=summary&url=/journals/journal_of_democracy/v018/18.2corrales.html) [during this period](http://muse.jhu.edu/login?auth=0&type=summary&url=/journals/journal_of_democracy/v022/22.1.corrales.pdf) counts against Venezuela. (I vaguely wondered whether perhaps a "Rawls index" could be constructed, using data like the [UDS](http://www.unified-democracy-scores.org/) to measure compliance with the first principle, fair equality of opportunity using the gini index, and the difference principle using the rate of growth of the income of the lowest decile; but since the two principles are supposed to be lexicographically ordered, a combined Rawlsian index would be pointless, useful only if we relax that assumption. Nevertheless, if we relaxed that assumption, then we would have to face the question of how much the improvement in the condition of the least well off ought to count against the decline in the "equal liberties" of the first principle; and I don't know of any good principled answer).

At the same time, it is interesting to note the countries at the very top are not precisely all left governments; Azerbaijan, Mongolia, and Ukraine appear there. This may be because the simulations are risibly wrong (an important possibility), or the data are wrong; or simply that policies of the kind the Chavez government tried out are not the only possible ones to bring about growth in the income of the poor (and now, with high inflation, sporadic shortages, a large black market premium for dollars, and other problems, they don't look especially sustainable either). Nevertheless, the high Rawlsian growth rate makes it easy to understand why many of the Venezuelan poor felt that Chavez improved their position, regardless of how much responsibility we ought to attribute to his government for that outcome, or how sustainable its policies may be with lower oil prices. 

Regardless, a good growth rate for the poorest decile matters: if inequality had remained at its maximum level during the Chavez years instead of declining but the growth rate had stayed the same, I estimate that the a representative of the poorest decile would have earned about $2000 less over the entire period than they actually did. We can call this quantity the "Rawls gap": the amount of income the poorest decile would have gained (or lost) in a given period had inequality remained the same as at the beginning of the period. Of course, since the growth rate would have been different had inequality remained the same, this is merely a fiction; we can't really estimate this counterfactual.

Nevertheless, just for fun, here is the Rawls gap for Latin America, per year:

```{r, RawlsGap, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}
data <- swiid_pwt[ !is.na(swiid_pwt$rgdpe), ] # uses the Penn World Table dataset, merged above with the SWIID dataset

data <- subset(data, country %in% LatinAmerica)

#data <- subset(data, country %in% ComparisonCases)

data <- subset(data, year > 1998)

data <- ddply(data, .(country), transform, N=length(country))

# Here we eliminate countries with fewer than 7 observations

data <- subset(data, N > 6)

data <- ddply(data, .(country), transform, gini_net_rawls_gap=gini_net[1])

# Drop unneeded vars

data <- subset(data, select=c("country","year","rgdpe","gini_net","gini_net_rawls_gap","pop"))

predicted_sdlog_data <- predict(model_gini,data.frame(gini = data$gini_net/100))

# Here we calculate deciles based on 100 iterations; depending on your system, this might take a while, since I'm not a particularly efficient coder.

#You actually get slightly different answers every time you do this; you'd probably need more iterations to get a reliable result, and you'd need to calculate confidence intervals and so on, but it takes too long on my machine.

simulated_deciles_2 <- calculate_decile_mean(100, predicted_sdlog_data)

predicted_sdlog_data <- predict(model_gini,data.frame(gini = data$gini_net_rawls_gap/100))

simulated_deciles_3 <- calculate_decile_mean(100, predicted_sdlog_data)

simulated_deciles_3$variable <- paste(simulated_deciles_3$variable,"_gap",sep="")

data <- merge(simulated_deciles_2,simulated_deciles_3,all.x=TRUE,all.y=TRUE)

data <- dcast(data, country + year ~ variable)

data$rawls_gap <- with(data, d10-d10_gap)

data <- ddply(data, .(country), transform, cum_rawls_gap = cumsum(rawls_gap))

data <- ddply(data, .(country), transform, total_rawls_gap = sum(rawls_gap))

data <- ddply(data, .(country), transform, mean_rawls_gap = mean(rawls_gap))

data <- ddply(data, .(country), transform, mean_d10_income = mean(d10))

data <- data[ order(data$mean_rawls_gap), ]

data$country <- reorder(data$country, -data$mean_rawls_gap)

fig17 <- ggplot(data=data,aes(x=year,y=rawls_gap))+geom_point()+geom_smooth()+facet_wrap(~country)+scale_y_continuous(label=dollar)+ylab("Rawls gap")

fig17

unique(data[ , c("country","total_rawls_gap","mean_rawls_gap", "mean_d10_income")])

```
This allows us to say that in Venezuela, the reduction of inequality that occurred during the Chavez (assuming, *per impossibile*, that the growth rate would have stayed exactly the same) period gained a representative person in the poorest decile a total of about $1500-$2500 over 10 years, or about $200 per year, whereas the increase in inequality over the same period in Costa Rica cost a representative person in the poorest decile about $800-$1200 in income, or about $100 per year. This is nothing to sneeze at for the poorest decile (whose average yearly income is only about $3000 per year). 

(It's kind of fun, though conceptually pointless and computationally expensive in my system given my crappy code, to calculate various Rawlsian gaps for arbitrary years and countries; for example, the "Rawls gap" for NZ is something like $2000 per year lost in income for the poorest decile if we assume the same growth trajectory but the level of inequality of the early 80s. Which of course we shouldn't - had inequality remained the same, the growth trajectory would have been different. As [Adam Przeworski](http://politics.as.nyu.edu/object/AdamPrzeworski) has said, everything is endogenous).

(We could also imagine even more exotic quantities, though I have no time to test them out here. Consider the Rawlsian compensatory growth rate, for example. This would be the growth rate that would compensate the poorest decile for an increase in inequality: if we want to say that some reform x would lead to higher income growth but higher inequality, then the compensatory Rawlsian growth rate is the growth rate where the income growth rate of the poorest decile at the higher level of inequality is identical to their income growth rate at a lower level of inequality but a lower overall growth rate for the economy; you would need a reform to produce at least the compensatory Rawlsian growth rate for it to be justified in terms of the difference principle. Which you may of course think is bogus). 

Now, absolute incomes matter too; the difference principle in Rawls is not usually understood in terms of growth rates (though I think that should be the more natural interpretation). But the second version of the Rawlsian question above (where do the poor have the highest incomes?) has a much more obvious and boring answer: the Scandinavian countries, due to both generally high incomes and low levels of inequality due to high redistribution; and most of the countries at the top also score well in terms of the first principle (measured inexactly here by the UDS, which perhaps ought to be discounted a bit given [recent developments](http://www.salon.com/2013/07/07/%E2%80%9Cwhy_did_you_shoot_me_i_was_reading_a_book_the_new_warrior_cop_is_out_of_control/) [in some countries](http://www.guardian.co.uk/world/prism)). I include it here for completeness: 

```{r RawlsianCountriesSince1999-2, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.height = 20, fig.width=11}

data <- subset(simulated_deciles, variable %in% c("d10","rgdpepop","gini_net","simulated_ginis"))

data <- dcast(data, country + year ~ variable)

data <- subset(data, year > 1998)

data <- ddply(data, .(country), transform, meand10 = mean(d10, na.rm=TRUE), N=length(country), gini_net = mean(gini_net,na.rm=TRUE))

data <- unique(data[ , c("country","meand10","gini_net","N")])

data <- subset(data, N > 6)

data <- data[ order(data$meand10,decreasing=TRUE), ]

data$country <- paste(seq_along(data$country),data$country)

data <- data[ order(data$meand10), ]

fig18 <- ggplot(data=data, aes(x=reorder(country,meand10)))+ geom_point(aes(y=meand10, color=gini_net)) + coord_flip() + scale_color_gradient2(midpoint=median(data$gini_net),low="blue",high="red") + scale_y_log10(labels=dollar)+labs(color="Avg. net gini",x="Country", y="Simulated avg. 1999-2010 income for lowest decile (Rawlsian minimum)")+ geom_vline(xintercept= grep("Venezuela|United States|China|New Zealand|Sweden|Egypt",data$country),linetype="dashed",color="red")+theme(legend.position="bottom")

fig18


```
The roots of that ranking of countries are much older and deeper than this dataset allows us to see.

In theory, both the first ("equal liberties") and the second principle of Rawls' theory ("fair equality of opportunity" plus the "difference principle") ought to go together. In practice, however, Rawls himself thought that they did not always do so, though his reasons for thinking this were not always clear. Though I don't really have the tools to tackle the question of the relationship between liberal rights and the rest of the components of Rawls' theory properly (certainly not here), it looks as if we see a kind of inverted-U relationship in the data:

```{r GrowthofPoorandDem, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=11}

data <- subset(simulated_deciles, variable %in% c("d10","rgdpepop","gini_net","simulated_ginis"))

data <- dcast(data, country + year ~ variable)

data <- calculate_slopes(data, depvar="log(d10)")

data <- rename(data, c("(Intercept)" = "Interceptd10","slope" = "RawlsGrowth","low"="RawlsLow","high"="RawlsHigh"))

data <- calculate_slopes(data, depvar="log(rgdpepop)")

data <- rename(data, c("(Intercept)" = "InterceptGrowth","slope" = "Growth","low"="GrowthLow","high"="GrowthHigh"))

data <- ddply(data, .(country), transform, minYear = min(year), maxYear = max(year), N=length(country))

data <- subset(data, N > 30)

data <- merge(data, swiid_uds)

data <- ddply(data, .(country), transform, meanDem= mean(mean), mean_gini=mean(gini_net))

data <- unique(data[, c("country","RawlsGrowth","meanDem","iso3c","N","mean_gini")])

fig18 <- ggplot(data=data, aes(x=RawlsGrowth,y=meanDem, alpha=N))+geom_text(aes(label=country,color=mean_gini))+geom_smooth()+labs(y="Mean Democracy score, UDS", x="Long-run Rawlsian growth rate \n(growth rate of income of poorest decile, simulated)") +scale_x_continuous(labels=percent) +scale_color_gradient2(midpoint=median(data$mean_gini),mid="pink",low="blue",high="red")+scale_alpha(range=c(0.5,1))

fig18
```
In other words, over the last half-century, the income of the poor has risen fastest under regimes that have not been on average highly democratic, but also has grown least in these regimes; non-democracy looks like a (potentially quite bad) gamble, though both democracy, long-run inequality, and the long-run growth rate of the income of the poor are probably determined by (or are a reflection of)  some deeper social fact, like state capacity, which is not really susceptible to policy intervention. Whatever state capacity is ([I have argued it is a kind of development of political technologies](http://papers.ssrn.com/sol3/papers.cfm?abstract_id=1052701)) it emerges out of political struggles that take a very long time to work themselves out with many tragic consequences along the way; and in any case the rate of improvement of state capacity is at times [immeasurably low](http://www.hks.harvard.edu/var/ezp_site/storage/fckeditor/file/pdfs/centers-programs/centers/cid/publications/faculty/articles_papers/pritchett/Capability_Traps.pdf). 